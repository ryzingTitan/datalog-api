openapi: 3.0.0
info:
  description: Swagger spec for the Datalog API project
  version: 3.0.0
  title: datalog-api
servers:
  - url: http://localhost:8080/api
    description: Local deployment
paths:
  /sessions/{sessionId}/datalogs:
    get:
      parameters:
        - name: sessionId
          in: path
          description: The session id to be used in the search query
          required: true
          schema:
            type: string
            format: uuid
            example: 515ef9d0-2059-4a11-b5c3-7c8dae93b57d
      tags:
        - Sessions
      description: Retrieve all sessions with the given session id sorted by timestamp ascending
      responses:
        200:
          description: The list of datalog records with the given session id sorted by timestamp ascending
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Datalog'
        400:
          description: Bad Request - Ensure the query parameter has been included in the request
        401:
          description: Unauthorized - Ensure the authorization token is valid
        500:
          description: Internal Server Error

  /sessions/upload:
    put:
      tags:
        - File Upload
      description: Upload a file with session data
      requestBody:
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                trackInfo:
                  $ref: '#/components/schemas/TrackInfo'
                user:
                  $ref: '#/components/schemas/User'
                uploadFile:
                  type: string
                  format: binary
      responses:
        200:
          description: Session data uploaded successfully
        400:
          description: Bad Request - Ensure the request contains all required data
        401:
          description: Unauthorized - Ensure the authorization token is valid
        500:
          description: Internal Server Error

  /sessions/metadata:
    get:
      parameters:
        - name: username
          in: query
          description: The email address (username) of the current user
          required: true
          schema:
            type: string
            format: email
            example: test@test.com
      tags:
        - Sessions
      description: Retrieve metadata for all sessions
      responses:
        200:
          description: The metadata for every session
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SessionMetadata'
        400:
          description: Bad Request - Ensure the query parameter has been included in the request
        401:
          description: Unauthorized - Ensure the authorization token is valid
        500:
          description: Internal Server Error

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  schemas:
    Datalog:
      type: object
      properties:
        sessionId:
          type: string
          format: uuid
          description: The session id of the datalog record
          example: 515ef9d0-2059-4a11-b5c3-7c8dae93b57d
        timestamp:
          type: string
          format: date-time
          description: The timestamp of the datalog record
          example: 2022-09-18T18:15:47.968Z
        data:
          $ref: '#/components/schemas/Data'
        trackInfo:
          $ref: '#/components/schemas/TrackInfo'
        user:
          $ref: '#/components/schemas/User'
    Data:
      type: object
      properties:
        longitude:
          type: number
          format: double
          description: The longitude location where the data was recorded
          example: -86.14170333333335
        latitude:
          type: number
          format: double
          description: The latitude location where the data was recorded
          example: 42.406800000000004
        altitude:
          type: number
          format: float
          description: The altitude where the data was recorded in meters
          example: 188.6
        intakeAirTemperature:
          type: integer
          format: int32
          description: The intake air temperature in degrees Fahrenheit
          example: 135
        boostPressure:
          type: number
          format: float
          description: The boost pressure in PSI
          example: 15.6
        coolantTemperature:
          type: integer
          format: int32
          description: The coolant temperature in degrees Fahrenheit
          example: 150
        engineRpm:
          type: integer
          format: int32
          description: The engine RPM
          example: 5000
        speed:
          type: integer
          format: int32
          description: The speed of the vehicle in MPH
          example: 85
        throttlePosition:
          type: number
          format: float
          description: The current percentage of the throttle position
          example: 75.6
        airFuelRatio:
          type: number
          format: float
          description: The current air fuel ratio
          example: 14.6
    TrackInfo:
      type: object
      properties:
        name:
          type: string
          description: The name of the track associated with the datalog
          example: Test Track
        latitude:
          type: number
          format: double
          description: The latitude location of the track
          example: 42.406800000000004
        longitude:
          type: number
          format: double
          description: The longitude location of the track
          example: -86.14170333333335
    User:
      type: object
      properties:
        firstName:
          type: string
          description: The first name of the user associated with the datalog
          example: Test
        lastName:
          type: string
          description: The last name of the user associated with the datalog
          example: Tester
        email:
          type: string
          format: email
          description: The email address of the user associated with the datalog
          example: test@test.com
    SessionMetadata:
      type: object
      properties:
        sessionId:
          type: string
          format: uuid
          description: The session id
          example: 515ef9d0-2059-4a11-b5c3-7c8dae93b57d
        startTime:
          type: string
          format: date-time
          description: The start time of the session
          example: 2022-09-18T18:15:47.968Z
        endTime:
          type: string
          format: date-time
          description: The end time of the session
          example: 2022-09-18T18:18:47.968Z

security:
  - bearerAuth: []